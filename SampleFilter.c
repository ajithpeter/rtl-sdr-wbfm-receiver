#include "SampleFilter.h"

static float filter_taps[SAMPLEFILTER_TAP_NUM] = {
  -0.005255580354468483,
  -0.0008131645863294295,
  -0.0008563115392434412,
  -0.0008879104761986334,
  -0.0009034929922233206,
  -0.0009034160935505566,
  -0.0008851033925846679,
  -0.000845292567069383,
  -0.0007828044186037936,
  -0.0006959554878492773,
  -0.0005821191844990833,
  -0.0004393455083174784,
  -0.0002659737030734574,
  -0.00006025541030748226,
  0.00017918387575667749,
  0.00045369098218680815,
  0.0007647692505508718,
  0.0011135831205539343,
  0.0015009053629425765,
  0.001927262132856994,
  0.0023929055198753024,
  0.002897871803899515,
  0.003441903824793514,
  0.00402443039953032,
  0.004644710974622996,
  0.005301726024591143,
  0.005994237340265741,
  0.006720847982224313,
  0.007479406399193341,
  0.008267151303517893,
  0.009081574318938305,
  0.009919915525327193,
  0.010779057057605589,
  0.011656504631436108,
  0.012548467573306037,
  0.013448898106535887,
  0.014354821531394816,
  0.015265638525149833,
  0.016171148762814454,
  0.017067596676064115,
  0.01796387526300686,
  0.018828832861786184,
  0.019679654496850052,
  0.020509838921411883,
  0.021309591004228207,
  0.022074242854563754,
  0.022800442830713447,
  0.023484454002920555,
  0.02412345773605435,
  0.024714325273446826,
  0.025253017312608785,
  0.025735943925392166,
  0.02616014636652625,
  0.026522932289278406,
  0.026822216406904496,
  0.02705645232489568,
  0.027224413629104535,
  0.027325383122762583,
  0.027359069477795532,
  0.027325383122762583,
  0.027224413629104535,
  0.02705645232489568,
  0.026822216406904496,
  0.026522932289278406,
  0.02616014636652625,
  0.025735943925392166,
  0.025253017312608785,
  0.024714325273446826,
  0.02412345773605435,
  0.023484454002920555,
  0.022800442830713447,
  0.022074242854563754,
  0.021309591004228207,
  0.020509838921411883,
  0.019679654496850052,
  0.018828832861786184,
  0.01796387526300686,
  0.017067596676064115,
  0.016171148762814454,
  0.015265638525149833,
  0.014354821531394816,
  0.013448898106535887,
  0.012548467573306037,
  0.011656504631436108,
  0.010779057057605589,
  0.009919915525327193,
  0.009081574318938305,
  0.008267151303517893,
  0.007479406399193341,
  0.006720847982224313,
  0.005994237340265741,
  0.005301726024591143,
  0.004644710974622996,
  0.00402443039953032,
  0.003441903824793514,
  0.002897871803899515,
  0.0023929055198753024,
  0.001927262132856994,
  0.0015009053629425765,
  0.0011135831205539343,
  0.0007647692505508718,
  0.00045369098218680815,
  0.00017918387575667749,
  -0.00006025541030748226,
  -0.0002659737030734574,
  -0.0004393455083174784,
  -0.0005821191844990833,
  -0.0006959554878492773,
  -0.0007828044186037936,
  -0.000845292567069383,
  -0.0008851033925846679,
  -0.0009034160935505566,
  -0.0009034929922233206,
  -0.0008879104761986334,
  -0.0008563115392434412,
  -0.0008131645863294295,
  -0.005255580354468483
};

void SampleFilter_init(SampleFilter* f) {
  int i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void SampleFilter_put(SampleFilter* f, float input) {
  f->history[f->last_index++] = input;
  if(f->last_index == SAMPLEFILTER_TAP_NUM)
    f->last_index = 0;
}

float SampleFilter_get(SampleFilter* f) {
  float acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : SAMPLEFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
